# ğŸ¬ MovieRec Sys - å½±è§†æ¨èç³»ç»Ÿ

**MovieRec Sys** æ˜¯ä¸€ä¸ªåŸºäº **Python 3.11** å¼€å‘çš„å½±è§†æ¨èç³»ç»Ÿã€‚å®ƒèåˆäº† **å¤§æ•°æ®è®¡ç®— (Spark)**ã€**è‡ªç„¶è¯­è¨€å¤„ç† (NLP/Transformers)** å’Œ **å®æ—¶ååŒè¿‡æ»¤** æŠ€æœ¯ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ç²¾å‡†çš„ä¸ªæ€§åŒ–ç”µå½±æ¨èæœåŠ¡ï¼Œå¹¶ä¸ºç®¡ç†å‘˜æä¾›å¼ºå¤§çš„æ•°æ®å¯è§†åŒ–å¤§å±ã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§ (Features)

### ğŸ§  æ··åˆæ¨èå¼•æ“

1. **ç¦»çº¿æ¨è (Spark ALS)**: ä½¿ç”¨ PySpark çš„äº¤æ›¿æœ€å°äºŒä¹˜æ³• (ALS) å¤„ç†æµ·é‡è¯„åˆ†æ•°æ®ï¼ŒæŒ–æ˜æ½œåœ¨çš„ User-Item å…³è”ï¼Œè§£å†³æ•°æ®ç¨€ç–æ€§é—®é¢˜ã€‚
2. **å®æ—¶æ¨è (Item-Based CF)**: åŸºäº Scikit-learn ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ï¼Œæ ¹æ®ç”¨æˆ·çš„å®æ—¶æ”¶è—å’Œè¯„åˆ†è¡Œä¸ºï¼Œæ¯«ç§’çº§å“åº”æ¨èç›¸ä¼¼ç”µå½±ã€‚
3. **æƒ…æ„Ÿè¯­ä¹‰æ¨è (NLP)**: é›†æˆ Hugging Face çš„ `chinese_xlm_xnli` æ¨¡å‹ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€è¾“å…¥ï¼ˆå¦‚â€œä»Šå¤©åŠ ç­å¥½ç´¯â€ï¼‰ï¼ŒAI è‡ªåŠ¨è¯†åˆ«æƒ…ç»ªå¹¶æ¨èæ²»æ„ˆç³»æˆ–è§£å‹å½±ç‰‡ã€‚
4. **å†·å¯åŠ¨ç­–ç•¥**: é’ˆå¯¹æ–°ç”¨æˆ·æä¾›åŸºäºçƒ­é—¨æ¦œå•ã€åˆ†ç±»ç²¾é€‰çš„å…œåº•æ¨èã€‚

### ğŸ“Š æ•°æ®å¯è§†åŒ–ä¸ç®¡ç†

* **å¯è§†åŒ–å¤§å±**: é›†æˆ Plotly ç»˜åˆ¶åŠ¨æ€å›¾è¡¨ï¼ŒåŒ…æ‹¬å•†ä¸šä»·å€¼æ°”æ³¡å›¾ã€é¢˜æç«ç‘°å›¾ã€ä¸­è¥¿å®¡ç¾å¯¹æ¯”å›¾ç­‰ã€‚
* **å…¨åŠŸèƒ½åå°**: åŸºäº NiceGUI å¼€å‘çš„ SPA (å•é¡µåº”ç”¨) ç®¡ç†åå°ï¼Œæ”¯æŒç”¨æˆ·ã€ç”µå½±ã€æ¼”èŒå‘˜ã€è¯„åˆ†ã€å‰§é›†çš„ CRUD æ“ä½œã€‚
* **æ•°æ®çˆ¬è™«**: å†…ç½®å¤šçº¿ç¨‹çˆ¬è™«ï¼Œæ”¯æŒæŠ“å– IMDb ç¥¨æˆ¿æ•°æ®å’Œè±†ç“£ Top250 æ¦œå•ã€‚

### ğŸ›  æŠ€æœ¯æ ˆ

* **å‰ç«¯/å…¨æ ˆ**: [NiceGUI](https://nicegui.io/) (åŸºäº FastAPI + Vue)
* **æ•°æ®åº“**: PostgreSQL (å¼‚æ­¥ asyncpg + åŒæ­¥ psycopg2)
* **å¤§æ•°æ®**: Apache Spark (PySpark)
* **AI/NLP**: PyTorch, Transformers (Hugging Face)
* **æ•°æ®åˆ†æ**: Pandas, Plotly

---

## ğŸ“‹ 1. ç¯å¢ƒå‡†å¤‡ (Prerequisites)

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨æˆ–æœ¬åœ°ç¯å¢ƒå·²å®‰è£…ä»¥ä¸‹åŸºç¡€è½¯ä»¶ã€‚

### 1.1 åŸºç¡€è½¯ä»¶

* **æ“ä½œç³»ç»Ÿ**: æ¨è Linux (Ubuntu/Debian) æˆ– Windowsã€‚
* **Python**: ç‰ˆæœ¬ **3.11**ã€‚
* **PostgreSQL**: æ•°æ®åº“æœåŠ¡ã€‚
* **Java JDK**: **å¿…é¡»å®‰è£… JDK 17** (ç”¨äº PySpark è¿è¡Œï¼ŒJDK 8 å·²ä¸å…¼å®¹æ–°ç‰ˆ PySpark)ã€‚
* **Git**: ç”¨äºå…‹éš†ä»£ç å’Œæ¨¡å‹ã€‚

### 1.2 Linux ç¯å¢ƒç‰¹åˆ«è¯´æ˜ (æ¨è)

å¦‚æœæ‚¨ä½¿ç”¨ Linux è™šæ‹Ÿæœºè·‘ Spark ä»»åŠ¡ï¼Œéœ€å®‰è£…ä»¥ä¸‹ç³»ç»Ÿçº§ä¾èµ–ï¼š

```bash
# æ›´æ–°æºå¹¶å®‰è£… JDK 17 å’Œ Python pip
sudo apt update
sudo apt install openjdk-17-jdk python3-pip -y

# éªŒè¯ Java ç‰ˆæœ¬ (å¿…é¡»è¾“å‡º 17.x)
java -version

```

---

## ğŸ› ï¸ 2. é¡¹ç›®åˆå§‹åŒ– (Installation)

### 2.1 è·å–ä»£ç ä¸åˆ›å»ºç¯å¢ƒ

å°†é¡¹ç›®ä»£ç ä¸‹è½½åˆ°æœ¬åœ°ç›®å½•ï¼ˆå‡è®¾æ ¹ç›®å½•ä¸º `movie/`ï¼‰ã€‚

**Windows:**

```bash
cd movie
python -m venv venv
venv\Scripts\activate

```

**Linux / Mac:**

```bash
cd movie
python3 -m venv venv
source venv/bin/activate

```

*(æ¿€æ´»æˆåŠŸåï¼Œå‘½ä»¤è¡Œå‰ä¼šå‡ºç° `(venv)` å­—æ ·)*

### 2.2 å®‰è£… Python ä¾èµ–

åœ¨æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…æ‰€éœ€åº“ã€‚

```bash
# æ ¸å¿ƒä¾èµ–åŒ…æ‹¬ nicegui, sqlalchemy, pyspark, pandas, transformers ç­‰
pip install -r requirements.txt

# Linux ç¯å¢ƒé¢å¤–å»ºè®®ï¼šç¡®ä¿å®‰è£… pyspark å’Œ psycopg2 ä¾èµ–
# pip install pyspark pandas sqlalchemy psycopg2-binary

```

---

## ğŸ—„ï¸ 3. æ•°æ®åº“éƒ¨ç½² (PostgreSQL)

æœ¬ç³»ç»Ÿå¼ºä¾èµ– PostgreSQLï¼Œéœ€å®Œæˆ**æ•°æ®å¯¼å…¥**å’Œ**è¿æ¥é…ç½®**ã€‚

### 3.1 å‡†å¤‡æ•°æ®åº“

ç™»å½• PostgreSQL å¹¶åˆ›å»ºæ•°æ®åº“ï¼š

* **æ•°æ®åº“å**: `movie_db`
* **ç”¨æˆ·å**: `postgresuser`
* **å¯†ç **: `password`

### 3.2 å¯¼å…¥ IMDb åŸå§‹æ•°æ®

è¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `movie_import.md` ä¸‹è½½å¹¶å¯¼å…¥æ•°æ®ã€‚

1. **ä¸‹è½½**: ä» IMDb å®˜ç½‘ä¸‹è½½ `name.basics.tsv.gz`, `title.basics.tsv.gz` ç­‰æ–‡ä»¶ã€‚
2. **è§£å‹**: ä½¿ç”¨ `gunzip *.tsv.gz`ã€‚
3. **å¯¼å…¥**: ä½¿ç”¨ SQL æ‰§è¡Œå»ºè¡¨å’Œæ•°æ®å¯¼å…¥ã€‚

```sql
-- ç¤ºä¾‹ï¼šå¯¼å…¥ title_basics
\COPY title_basics FROM '/path/to/title.basics.tsv' WITH (FORMAT csv, DELIMITER E'\t', NULL '\N', HEADER true, QUOTE E'\b');

```

### 3.3 é…ç½®æ•°æ®åº“è¿æ¥

ä¿®æ”¹ `database.py` å’Œ `spark_runner.py` ä¸­çš„è¿æ¥å­—ç¬¦ä¸²ã€‚

* **Web æœåŠ¡ (`database.py`)**:
```python
# å¿…é¡»ä½¿ç”¨ asyncpg
DATABASE_URL = "postgresql+asyncpg://postgresuser:password@localhost:5432/movie_db"

```


* **Spark ä»»åŠ¡ (`spark_runner.py`)**:
```python
# å¿…é¡»ä½¿ç”¨ psycopg2
DATABASE_URL = "postgresql+psycopg2://postgresuser:password@localhost:5432/movie_db"

```



---

## ğŸ¤– 4. NLP æ¨¡å‹é…ç½®

ç³»ç»Ÿä½¿ç”¨ Hugging Face çš„ `chinese_xlm_xnli` æ¨¡å‹è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œéœ€ä¸‹è½½åˆ°æœ¬åœ°ã€‚

1. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ `ml_models`ã€‚
2. è¿›å…¥æ–‡ä»¶å¤¹å¹¶å…‹éš†æ¨¡å‹ï¼ˆéœ€å®‰è£… Git LFSï¼‰ï¼š
```bash
cd ml_models
git clone https://huggingface.co/morit/chinese_xlm_xnli

```


*> æ£€æŸ¥ç‚¹ï¼šç¡®ä¿ `ml_models/chinese_xlm_xnli/` ç›®å½•ä¸‹åŒ…å« `pytorch_model.bin` ç­‰æ–‡ä»¶ã€‚*

---

## âš™ï¸ 5. ç³»ç»Ÿåˆå§‹åŒ– (Initialization)

åœ¨å¯åŠ¨æœåŠ¡å‰ï¼Œå¿…é¡»æŒ‰é¡ºåºè¿è¡Œä»¥ä¸‹è„šæœ¬ä»¥åŒæ­¥è¡¨ç»“æ„å¹¶ç”Ÿæˆåˆå§‹æ•°æ®ã€‚

1. **åŒæ­¥æ•°æ®åº“è¡¨ç»“æ„** (åˆ›å»ºç”¨æˆ·è¡¨ã€æ”¶è—è¡¨ã€æ¨èè¡¨ç­‰):
```bash
python init/init_db.py

```


2. **æ·»åŠ æ•°æ®åº“ç´¢å¼•** (æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œè€—æ—¶è¾ƒé•¿):
```bash
python init/add_index.py

```


3. **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·** (æŒ‰æç¤ºè¾“å…¥è´¦å·ä¿¡æ¯):
```bash
python init/create_admin.py

```


4. **ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®** (å¯é€‰ï¼Œç”Ÿæˆè™šæ‹Ÿç”¨æˆ·å’Œè¯„åˆ†ç”¨äºæµ‹è¯•æ¨è):
```bash
python init/seed_ratings.py

```


5. **ç”Ÿæˆå›¾è¡¨ç¼“å­˜** (ç”¨äºåå°ä»ªè¡¨ç›˜å±•ç¤º):
```bash
python init/generate_charts.py

```



---

## âš¡ 6. è¿è¡Œæ¨èç®—æ³•

### 6.1 ç¦»çº¿æ¨è (Spark ALS)

ä½¿ç”¨ PySpark è¿›è¡Œå¤§è§„æ¨¡çŸ©é˜µè®¡ç®—ã€‚**å»ºè®®åœ¨ Linux ç¯å¢ƒä¸‹è¿è¡Œæ­¤æ­¥éª¤**ã€‚

```bash
python spark_runner.py

```

**é¢„æœŸè¾“å‡ºï¼š**

* æ˜¾ç¤º `ğŸš€ [Step 1] åˆå§‹åŒ– Spark...`
* æœ€ç»ˆæ˜¾ç¤º `âœ… æˆåŠŸï¼å·²ä¿å­˜ XX æ¡æ¨èè®°å½•ã€‚`

### 6.2 å®æ—¶æ¨èæ¨¡å‹è®­ç»ƒ

ç”Ÿæˆ Item-Based CF æ‰€éœ€çš„ç›¸ä¼¼åº¦çŸ©é˜µï¼ˆåŸºäºå†…å­˜ï¼‰ã€‚

* ç™»å½•åå° -> **ä»ªè¡¨ç›˜** -> ç‚¹å‡» **â€œç«‹å³é‡æ–°è®­ç»ƒâ€**ã€‚
* æˆ–è€…ç›´æ¥åœ¨ä»£ç ä¸­è°ƒç”¨ `services.recommendation_service.train_model()`ã€‚

---

## ğŸš€ 7. å¯åŠ¨ Web æœåŠ¡

ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œå¯åŠ¨ä¸»ç¨‹åºï¼š

```bash
python main.py

```

* **è®¿é—®åœ°å€**: [http://localhost:61081](https://www.google.com/search?q=http://localhost:61081)
* **åå°ç®¡ç†**: ç™»å½•åç‚¹å‡»å³ä¸Šè§’å¤´åƒ -> â€œåå°ç®¡ç†â€ã€‚

---

## ğŸ•·ï¸ é™„å½•ï¼šæ•°æ®çˆ¬è™« (Optional)

å¦‚æœéœ€è¦è¡¥å……ç¥¨æˆ¿æ•°æ®æˆ–è±†ç“£è¯„åˆ†ï¼Œå¯è¿è¡Œçˆ¬è™«è„šæœ¬ï¼š

1. **çˆ¬å–ç¥¨æˆ¿æ•°æ®** (Box Office Mojo):
```bash
python crawlers/box_office_crawler.py

```


2. **çˆ¬å–è±†ç“£ Top 250**:
*(æ³¨æ„ï¼šéœ€åœ¨ä»£ç ä¸­é…ç½® Cookie)*
```bash
python crawlers/top250_crawler.py

```



---

## â“ å¸¸è§é—®é¢˜ (Troubleshooting)

| é—®é¢˜ç°è±¡ | è§£å†³æ–¹æ¡ˆ |
| --- | --- |
| **Spark æŠ¥é”™ `class file version 61.0**` | Java ç‰ˆæœ¬è¿‡ä½ã€‚Spark æ–°ç‰ˆéœ€è¦ Java 17ã€‚è¯·å®‰è£… JDK 17 å¹¶é€šè¿‡ `update-alternatives` åˆ‡æ¢é»˜è®¤ç‰ˆæœ¬ã€‚ |
| **Spark æŠ¥é”™ `winutils**` | Windows ç¯å¢ƒå¸¸è§é”™è¯¯ã€‚å»ºè®®åœ¨ WSL æˆ– Linux è™šæ‹Ÿæœºä¸­è¿è¡Œ `spark_runner.py`ã€‚ |
| **NLP æ¨¡å‹åŠ è½½å¤±è´¥** | æ£€æŸ¥ `ml_models` ç›®å½•è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œä¸”å·²å®‰è£… `torch` åº“ã€‚ |
| **é¦–é¡µå›¾ç‰‡ä¸æ˜¾ç¤º** | ç¡®ä¿å·²æ­£ç¡®é…ç½® TMDB API Key (`services/tmdb_service.py`)ï¼Œå¹¶ç‚¹å‡»åå°çš„ **"å½±è§†ç®¡ç†" -> "é‡å»ºç¼“å­˜"**ã€‚ |
| **å›¾è¡¨æ— æ³•åŠ è½½** | è¯·è¿è¡Œ `python init/generate_charts.py` ç”Ÿæˆé™æ€ HTML æ–‡ä»¶ã€‚ |